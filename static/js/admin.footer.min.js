/*! blog-static 03-12-2014 */
jQuery.extend({createUploadIframe:function(a,b){var c="jUploadFrame"+a,d='<iframe id="'+c+'" name="'+c+'" style="position:absolute; top:-9999px; left:-9999px"';return window.ActiveXObject&&("boolean"==typeof b?d+=' src="javascript:false"':"string"==typeof b&&(d+=' src="'+b+'"')),d+=" />",jQuery(d).appendTo(document.body),jQuery("#"+c).get(0)},createUploadForm:function(a,b,c){var d="jUploadForm"+a,e="jUploadFile"+a,f=jQuery('<form  action="" method="POST" name="'+d+'" id="'+d+'" enctype="multipart/form-data"></form>');if(c)for(var g in c)jQuery('<input type="hidden" name="'+g+'" value="'+c[g]+'" />').appendTo(f);var h=jQuery("#"+b),i=jQuery(h).clone();return jQuery(h).attr("id",e),jQuery(h).before(i),jQuery(h).appendTo(f),jQuery(f).css("position","absolute"),jQuery(f).css("top","-1200px"),jQuery(f).css("left","-1200px"),jQuery(f).appendTo("body"),f},ajaxFileUpload:function(a){a=jQuery.extend({},jQuery.ajaxSettings,a);var b=(new Date).getTime(),c=jQuery.createUploadForm(b,a.fileElementId,"undefined"==typeof a.data?!1:a.data),d=(jQuery.createUploadIframe(b,a.secureuri),"jUploadFrame"+b),e="jUploadForm"+b;a.global&&!jQuery.active++&&jQuery.event.trigger("ajaxStart");var f=!1,g={};a.global&&jQuery.event.trigger("ajaxSend",[g,a]);var h=function(b){var e=document.getElementById(d);try{e.contentWindow?(g.responseText=e.contentWindow.document.body?e.contentWindow.document.body.innerHTML:null,g.responseXML=e.contentWindow.document.XMLDocument?e.contentWindow.document.XMLDocument:e.contentWindow.document):e.contentDocument&&(g.responseText=e.contentDocument.document.body?e.contentDocument.document.body.innerHTML:null,g.responseXML=e.contentDocument.document.XMLDocument?e.contentDocument.document.XMLDocument:e.contentDocument.document)}catch(h){jQuery.handleError(a,g,null,h)}if(g||"timeout"==b){f=!0;var i;try{if(i="timeout"!=b?"success":"error","error"!=i){var j=jQuery.uploadHttpData(g,a.dataType);a.success&&a.success(j,i),a.global&&jQuery.event.trigger("ajaxSuccess",[g,a])}else jQuery.handleError(a,g,i)}catch(h){i="error",jQuery.handleError(a,g,i,h)}a.global&&jQuery.event.trigger("ajaxComplete",[g,a]),a.global&&!--jQuery.active&&jQuery.event.trigger("ajaxStop"),a.complete&&a.complete(g,i),jQuery(e).unbind(),setTimeout(function(){try{jQuery(e).remove(),jQuery(c).remove()}catch(b){jQuery.handleError(a,g,null,b)}},100),g=null}};a.timeout>0&&setTimeout(function(){f||h("timeout")},a.timeout);try{var c=jQuery("#"+e);jQuery(c).attr("action",a.url),jQuery(c).attr("method","POST"),jQuery(c).attr("target",d),c.encoding?jQuery(c).attr("encoding","multipart/form-data"):jQuery(c).attr("enctype","multipart/form-data"),jQuery(c).submit()}catch(i){jQuery.handleError(a,g,null,i)}return jQuery("#"+d).load(h),{abort:function(){}}},uploadHttpData:function(r,type){var data=!type;return data="xml"==type||data?r.responseXML:r.responseText,"script"==type&&jQuery.globalEval(data),"json"==type&&eval("data = "+data),"html"==type&&jQuery("<div>").html(data).evalScripts(),data}}),function(){$(document).ready(function(e){var article_manage_box,article_manage_menu,attach_manage_box,attach_manage_menu,default_box,default_menu,edit_submit,editor_html,gen_list,get_local,get_page,menu_bar_html,new_ariticle_box,new_article_menu,oss_manage_box,oss_manage_menu,show_frame,ue;return ue=null,default_menu=$("#default-menu"),new_article_menu=$("#new-article-menu"),article_manage_menu=$("#article-manage-menu"),attach_manage_menu=$("#attach-manage-menu"),oss_manage_menu=$("#oss-manage-menu"),default_box=$("#default-box"),new_ariticle_box=$("#new-article-box"),article_manage_box=$("#article-manage-box"),attach_manage_box=$("#attach-manage-box"),oss_manage_box=$("#oss-manage-box"),show_frame=function(a){var b,c,d,e,f,g,h;for(e=[default_menu,new_article_menu,article_manage_menu,attach_manage_menu,oss_manage_menu],b=[default_box,new_ariticle_box,article_manage_box,attach_manage_box,oss_manage_box],h=[],c=f=0,g=e.length;g>f;c=++f)d=e[c],a===c?(d.show(),h.push(b[c].show())):(d.hide(),h.push(b[c].hide()));return h},get_local=function(){var index;return index=window.location.href.replace(/\./g,"_").replace(/:/g,"_").replace(/\//g,"_").replace(/___/g,"_")+"myEditor-drafts-data",eval("["+localStorage.getItem("ueditor_preference")+"]")[0][index]},edit_submit=function(a){return a?(show_frame(1),ue.setContent(a.content),$("#article-title").val(a.title),$("#article-tags").val(a.keywords),$("#submit").unbind("click"),$("#submit").click(function(){var b,c,d;return b=ue.getContent(),c=$("#article-title").val(),d=$("#article-tags").val(),$.ajax({type:"post",url:"/update",data:{id:a.id,title:c,keywords:d,content:b},dataType:"json",success:function(a){return alert(a.msg)}})})):($("#submit").unbind("click"),$("#submit").click(function(){var a,b,c;return a=ue.getContent(),b=$("#article-title").val(),c=$("#article-tags").val(),$.ajax({type:"post",url:"/add",data:{title:b,keywords:c,content:a},dataType:"json",success:function(a){return console.log(a),a.result?(ue.setContent(""),$("#article-title").val(""),$("#article-tags").val(""),alert("发布成功-"+a.msg)):alert("发布失败-"+a.msg)}})}))},gen_list=function(a){var b,c,d,e,f,g,h,i;if(b=$(".amb-content"),d='<ul><li class="admin-amb-banner"><ul>\n<li class="admin-col-id admin-amb-cell">ID</li>\n<li class="admin-col-title admin-amb-cell">文章标题</li>\n<li class="admin-col-author admin-amb-cell">作者</li>\n<li class="admin-col-time admin-amb-cell">发布时间</li>\n<li class="admin-col-count admin-amb-cell">阅读量</li>\n<li class="admin-col-operation admin-amb-cell">操作</li>\n</ul></li>',c='<li class="admin-amb-banner"><ul>\n<li class="admin-col-id admin-amb-cell">ID</li>\n<li class="admin-col-title admin-amb-cell">文章标题</li>\n<li class="admin-col-author admin-amb-cell">作者</li>\n<li class="admin-col-time admin-amb-cell">发布时间</li>\n<li class="admin-col-count admin-amb-cell">阅读量</li>\n<li class="admin-col-operation admin-amb-cell">操作</li>\n</ul></li></ul>',i='<div style="margin-left: 20px;">',a.page>1&&(i+='<a id="prev-page">上一页</a>'),h="</a>",a.nextPage&&(h+='<a id="next-page">下一页</a>'),a.result){if(a.data){g=a.data,e="";for(f in g)e+='<li class="admin-amb-line"><ul><li class="admin-col-id admin-amb-cell" title="'+g[f].id+'">'+g[f].id+'</li><li class="admin-col-title admin-amb-cell" title="'+g[f].title+'"><a target="_blank" href="/article/'+g[f].uri+'">'+g[f].title+'</a></li><li class="admin-col-author admin-amb-cell" title="'+g[f].author+'">'+g[f].author+'</li><li class="admin-col-time admin-amb-cell" title="'+g[f].time+'">'+g[f].time+'</li><li class="admin-col-count admin-amb-cell" title="'+g[f].count+'">'+g[f].count+'</li><li class="admin-col-operation admin-amb-cell"><a id="edit" data="'+g[f].id+'" style="padding-right: 5px;">辑</a><a id="del" data="'+g[f].id+'" style="padding-left: 5px;">删</a></li></ul></li>';return d+e+c+i+h}return""}return""},get_page=function(a){var b;return b="/admin/article/page/"+a,$.ajax({type:"get",url:b,dataType:"json",success:function(b){var c;return c=gen_list(b),$("#article-manage-box").html(c),$(".admin-amb-banner li").css({"background-color":"#ccc"}),$(".admin-amb-line:odd li").css({"background-color":"#ddd"}),$("#article-manage-box").undelegate(),$("#article-manage-box").delegate("#edit","click",function(){var a,c,d,e;c=$(this).attr("data"),d=null;for(e in b.data)a=b.data,c===a[e].id&&(d=a[e]);return edit_submit(d)}).delegate("#del","click",function(){var b;if(window.confirm("是否确认要删除文档？"))return b=$(this).attr("data"),console.log("delete "+b),$.ajax({type:"post",url:"/delete",data:{id:b},dataType:"json",success:function(b){return alert(b.msg),get_page(a)}})}),$("#prev-page").click(function(){return get_page(a-1)}),$("#next-page").click(function(){return get_page(a+1)})}})},$(".admin-title").click(function(){return show_frame(0)}),$("#new-ariticle").click(function(){var a;return show_frame(1),edit_submit(),a=get_local(),a&&a!==ue.getContent()?ue.setContent(window.confirm("是否加载上次未保存的内容？")?a:""):void 0}),$("#article-manage").click(function(){return show_frame(2),get_page(1)}),$("#attach-manage").click(function(){return show_frame(3)}),$("#oss-manage").click(function(){return show_frame(4)}),menu_bar_html='<label for="article-title" style="margin-left: 10px;color:white;">文章标题</label><input type="text" name="title" id="article-title" style="margin-left: 10px;margin-top: 7px;width: 250px;"><label for="article-tags" style="color: white;margin-left: 10px;margin-right: 10px;">关键词</label><input type="text" name="tags" placeholder="逗号,分隔" id="article-tags" class="article-tags"><button id="submit" style="margin-left: 10px;background-color: white;border-radius: 4px;">发布</button>',editor_html='<textarea class="m-input d-input" name="content" id="myEditor" style="width:100%;height:430px;"></textarea>',new_article_menu.html(menu_bar_html),new_ariticle_box.html(editor_html),ue=UE.getEditor("myEditor"),new_article_menu.hide(),new_ariticle_box.hide()})}.call(this);