/*! goblog 2015-08-30 */
"use strict";function adminRouteConfig(a,b){a.when("/admin",{controller:IndexController,templateUrl:"/static/ng/default.html"}).when("/admin/new_article",{controller:NewArticleController,templateUrl:"/static/ng/new_article.html"}).when("/admin/edit_article",{controller:EditArticleController,templateUrl:"/static/ng/edit_article.html"}).when("/admin/edit_article/:id",{controller:EditArticleController,templateUrl:"/static/ng/edit_article.html"}).when("/admin/manage_article",{controller:ManageArticleController,templateUrl:"/static/ng/manage_article.html"}).when("/admin/manage_article/:page",{controller:ManageArticleController,templateUrl:"/static/ng/manage_article.html"}).when("/admin/manage_project",{controller:ManageProjectController,templateUrl:"/static/ng/manage_project.html"}).when("/admin/manage_project/:page",{controller:ManageProjectController,templateUrl:"/static/ng/manage_project.html"}).when("/admin/manage_oss",{controller:ManageOssController,templateUrl:"/static/ng/manage_oss.html"}).otherwise({redirectTo:"/admin"}),b.html5Mode(!0)}function NavsController(a,b,c){b.get("/api/admin/navlist",null).success(function(b){a.navs=b,a.currentPath=c.path().replace("/admin","").replace("/","")})}function IndexController(a,b,c,d){b.global={title:"首页",currentPath:""},c.get("http://duoshuo.com/api/posts/list.json?short_name=duguying&order=desc",null).success(function(b){a.comments=angular.forEach(angular.fromJson(b.parentPosts),function(a){a.message_html=d.trustAsHtml(a.message)})})}function NewArticleController(a,b,c,d){b.global={title:"添加文章",currentPath:"new_article"},a.config=ueditor_option,a.submit=function(){var b=a.content,e=a.title,f=a.keywords,g=a["abstract"];c.post("/api/admin/add",{params:{title:e,keywords:f,"abstract":g,content:b}}).success(function(a){a.result?(alert("add success."),d.path("/admin/edit_article/"+a.data)):alert("add failed.",a.msg)})}}function EditArticleController(a,b,c,d){var e=c.id||0;a.id=parseInt(e),d.get("/api/admin/article/"+e,null).success(function(b){a.article=b.data}),b.global={title:"编辑文章",currentPath:"manage_article"},a.config=ueditor_option,a.submit=function(){var b=a.article.Content,c=a.article.Title,e=a.article.Keywords,f=a.article.Abstract;d.post("/api/admin/update",{params:{id:a.id,title:c,keywords:e,"abstract":f,content:b}}).success(function(a){a.result?alert("modified success."):alert("modified failed.",a.msg)})}}function ManageArticleController(a,b,c,d){c.global={title:"管理文章",currentPath:"manage_article"};var e=d.page||1;a.get("/api/admin/article/page/"+e,null).success(function(a){b.articles=a.data,b.has_next=a.nextPage,b.page=parseInt(e)})}function ManageProjectController(a,b,c,d,e){c.global={title:"管理项目",currentPath:"manage_project"};var f=d.page||1;a.get("/api/admin/project/list/"+f,null).success(function(a){b.total_pages=a.total_pages,b.has_next=a.has_next,b.page=parseInt(f),b.projects=angular.forEach(angular.fromJson(a.data),function(a){a.description_html=e.trustAsHtml(a.description)})})}function ManageOssController(a,b){b.global={title:"OSS管理",currentPath:"manage_oss"}}var adminService=angular.module("Admin",["ngRoute","ng.ueditor"]);adminService.config(adminRouteConfig);var ueditor_option={toolbars:[["source","forecolor","backcolor","insertorderedlist","insertunorderedlist","simpleupload","|","justifyleft","justifyright","justifycenter","justifyjustify","|","inserttable","fontfamily","fontsize","paragraph","insertcode"],["bold","italic","underline","strikethrough","|","subscript","fontborder","superscript","|","undo","redo","indent","snapscreen","blockquote","pasteplain","selectall","preview","horizontal","removeformat","time","date","unlink","link","emotion","spechars","searchreplace","map","insertvideo","help","fullscreen","edittip ","touppercase","tolowercase","music","drafts","charts"]],initialFrameHeight:500,autoHeightEnabled:!1,autoFloatEnabled:!1};adminService.directive("deleteArticle",function(a,b){return{restrict:"A",require:"ngModel",link:function(a,c,d,e){c.bind("click",function(){var c=e.$modelValue.id;window.confirm("Sure to Delete ["+e.$modelValue.title+"]?")&&b.post("/api/admin/delete",{params:{id:parseInt(c)}}).success(function(b){if(b.result){console.log("add success.");for(var d=0;d<a.articles.length;d++)a.articles[d].id==parseInt(c)&&a.articles.splice(d,1)}else console.log("add failed.",b.msg)})})}}});