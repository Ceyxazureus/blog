!function(){$(document).ready(function(e){var article_manage_box,article_manage_menu,attach_manage_box,attach_manage_menu,default_box,default_menu,edit_submit,editor_html,gen_list,get_local,get_page,menu_bar_html,new_ariticle_box,new_article_menu,oss_manage_box,oss_manage_menu,show_frame,ue;return ue=null,default_menu=$("#default-menu"),new_article_menu=$("#new-article-menu"),article_manage_menu=$("#article-manage-menu"),attach_manage_menu=$("#attach-manage-menu"),oss_manage_menu=$("#oss-manage-menu"),default_box=$("#default-box"),new_ariticle_box=$("#new-article-box"),article_manage_box=$("#article-manage-box"),attach_manage_box=$("#attach-manage-box"),oss_manage_box=$("#oss-manage-box"),show_frame=function(e){var a,t,i,l,n,c,o;for(l=[default_menu,new_article_menu,article_manage_menu,attach_manage_menu,oss_manage_menu],a=[default_box,new_ariticle_box,article_manage_box,attach_manage_box,oss_manage_box],o=[],t=n=0,c=l.length;c>n;t=++n)i=l[t],e===t?(i.show(),o.push(a[t].show())):(i.hide(),o.push(a[t].hide()));return o},get_local=function(){var index;return index=window.location.href.replace(/\./g,"_").replace(/:/g,"_").replace(/\//g,"_").replace(/___/g,"_")+"myEditor-drafts-data",eval("["+localStorage.getItem("ueditor_preference")+"]")[0][index]},edit_submit=function(e){return e?(show_frame(1),ue.setContent(e.content),$("#article-title").val(e.title),$("#article-tags").val(e.keywords),$("#submit").unbind("click"),$("#submit").click(function(){var a,t,i;return a=ue.getContent(),t=$("#article-title").val(),i=$("#article-tags").val(),$.ajax({type:"post",url:"/update",data:{id:e.id,title:t,keywords:i,content:a},dataType:"json",success:function(e){return alert(e.msg)}})})):($("#submit").unbind("click"),$("#submit").click(function(){var e,a,t;return e=ue.getContent(),a=$("#article-title").val(),t=$("#article-tags").val(),$.ajax({type:"post",url:"/add",data:{title:a,keywords:t,content:e},dataType:"json",success:function(e){return console.log(e),e.result?(ue.setContent(""),$("#article-title").val(""),$("#article-tags").val(""),alert("发布成功-"+e.msg)):alert("发布失败-"+e.msg)}})}))},gen_list=function(e){var a,t,i,l,n,c,o,r;if(a=$(".amb-content"),i='<ul><li class="admin-amb-banner"><ul>\n<li class="admin-col-id admin-amb-cell">ID</li>\n<li class="admin-col-title admin-amb-cell">文章标题</li>\n<li class="admin-col-author admin-amb-cell">作者</li>\n<li class="admin-col-time admin-amb-cell">发布时间</li>\n<li class="admin-col-count admin-amb-cell">阅读量</li>\n<li class="admin-col-operation admin-amb-cell">操作</li>\n</ul></li>',t='<li class="admin-amb-banner"><ul>\n<li class="admin-col-id admin-amb-cell">ID</li>\n<li class="admin-col-title admin-amb-cell">文章标题</li>\n<li class="admin-col-author admin-amb-cell">作者</li>\n<li class="admin-col-time admin-amb-cell">发布时间</li>\n<li class="admin-col-count admin-amb-cell">阅读量</li>\n<li class="admin-col-operation admin-amb-cell">操作</li>\n</ul></li></ul>',r='<div style="margin-left: 20px;">',e.page>1&&(r+='<a id="prev-page">上一页</a>'),o="</a>",e.nextPage&&(o+='<a id="next-page">下一页</a>'),e.result){if(e.data){c=e.data,l="";for(n in c)l+='<li class="admin-amb-line"><ul><li class="admin-col-id admin-amb-cell" title="'+c[n].id+'">'+c[n].id+'</li><li class="admin-col-title admin-amb-cell" title="'+c[n].title+'">'+c[n].title+'</li><li class="admin-col-author admin-amb-cell" title="'+c[n].author+'">'+c[n].author+'</li><li class="admin-col-time admin-amb-cell" title="'+c[n].time+'">'+c[n].time+'</li><li class="admin-col-count admin-amb-cell" title="'+c[n].count+'">'+c[n].count+'</li><li class="admin-col-operation admin-amb-cell"><a id="edit" data="'+c[n].id+'" style="padding-right: 5px;">辑</a><a id="del" data="'+c[n].id+'" style="padding-left: 5px;">删</a></li></ul></li>';return i+l+t+r+o}return""}return""},get_page=function(e){var a;return a="/admin/article/page/"+e,$.ajax({type:"get",url:a,dataType:"json",success:function(a){var t;return t=gen_list(a),$("#article-manage-box").html(t),$(".admin-amb-banner li").css({"background-color":"#ccc"}),$(".admin-amb-line:odd li").css({"background-color":"#ddd"}),$("#article-manage-box").undelegate(),$("#article-manage-box").delegate("#edit","click",function(){var e,t,i,l;t=$(this).attr("data"),i=null;for(l in a.data)e=a.data,t===e[l].id&&(i=e[l]);return edit_submit(i)}).delegate("#del","click",function(){var a;if(window.confirm("是否确认要删除文档？"))return a=$(this).attr("data"),console.log("delete "+a),$.ajax({type:"post",url:"/delete",data:{id:a},dataType:"json",success:function(a){return alert(a.msg),get_page(e)}})}),$("#prev-page").click(function(){return get_page(e-1)}),$("#next-page").click(function(){return get_page(e+1)})}})},$(".admin-title").click(function(){return show_frame(0)}),$("#new-ariticle").click(function(){var e;return show_frame(1),edit_submit(),e=get_local(),e&&e!==ue.getContent()?window.confirm("是否加载上次未保存的内容？")?ue.setContent(e):ue.setContent(""):void 0}),$("#article-manage").click(function(){return show_frame(2),get_page(1)}),$("#attach-manage").click(function(){return show_frame(3)}),$("#oss-manage").click(function(){return show_frame(4)}),menu_bar_html='<label for="article-title" style="margin-left: 10px;color:white;">文章标题</label><input type="text" name="title" id="article-title" style="margin-left: 10px;margin-top: 7px;width: 250px;"><label for="article-tags" style="color: white;margin-left: 10px;margin-right: 10px;">关键词</label><input type="text" name="tags" placeholder="逗号,分隔" id="article-tags" class="article-tags"><button id="submit" style="margin-left: 10px;background-color: white;border-radius: 4px;">发布</button>',editor_html='<textarea class="m-input d-input" name="content" id="myEditor" style="width:100%;height:430px;"></textarea>',new_article_menu.html(menu_bar_html),new_ariticle_box.html(editor_html),ue=UE.getEditor("myEditor"),new_article_menu.hide(),new_ariticle_box.hide()})}.call(this);